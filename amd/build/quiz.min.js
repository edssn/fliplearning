define ("local_fliplearning/quiz",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/moment","local_fliplearning/pagination","local_fliplearning/chartdynamic","local_fliplearning/pageheader","local_fliplearning/helpdialog"],function(a,b,c,d,e,f,g,h){"use strict";return{init:function(d){a.use(b);a.component("pagination",e);a.component("chart",f);a.component("pageheader",g);a.component("helpdialog",h);var i=new a({delimiters:["[[","]]"],el:"#teacher_assessments",vuetify:new b,data:function data(){return{strings:d.strings,groups:d.groups,userid:d.userid,courseid:d.courseid,timezone:d.timezone,render_has:d.profile_render,loading:!1,errors:[],pages:d.pages,quiz:d.quiz,questions_attempts_colors:d.questions_attempts_colors,hardest_questions_colors:d.hardest_questions_colors,default_quiz:null,attempts_categories:[],attempts_series:[],attempts_questions:[],hardest_categories:[],hardest_series:[],hardest_questions:[],help_dialog:!1,help_contents:[],pluginSectionName:"teacher_assessments",questions_attempts_chart:"questions_attempts_chart",hardest_questions_chart:"hardest_questions_chart"}},beforeMount:function beforeMount(){if(this.quiz.length){this.default_quiz=this.quiz[0].attempts;this.calculate_questions_attempts(this.default_quiz)}},mounted:function mounted(){document.querySelector("#teacher_assessments_loader").style.display="none";document.querySelector("#teacher_assessments").style.display="block"},methods:{get_help_content:function get_help_content(){var a=[{title:this.strings.section_help_title,description:this.strings.section_help_description}];return a},get_quiz_info_text1:function get_quiz_info_text1(){var a="";if(this.default_quiz){a="* ".concat(this.strings.quiz_number_questions,": ").concat(this.default_quiz.details.questions)}return a},get_quiz_info_text2:function get_quiz_info_text2(){var a="";if(this.default_quiz){a="* ".concat(this.strings.quiz_attempts_done,": ").concat(this.default_quiz.details.attempts)}return a},get_quiz_info_text3:function get_quiz_info_text3(){var a="";if(this.default_quiz){a="* ".concat(this.strings.quiz_students_attempts,": ").concat(this.default_quiz.details.users)}return a},build_questions_attempts_chart:function build_questions_attempts_chart(){var a={};a.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.questions_attempts_colors;a.xAxis={categories:this.attempts_categories};a.yAxis=[{min:0,allowDecimals:!1,title:{text:this.strings.questions_attempts_yaxis_title}}];a.tooltip={useHTML:!0,formatter:function formatter(){var a=this.x,b=this.y,c=this.total,d=Math.round(+this.percentage),e=this.series.name,f=i.strings.of_conector,g=i.strings.review_question;return"<small>"+a+"</small></br><b style=\"color: "+this.color+";\">\u2022 </b>"+e+": "+b+" "+f+" "+c+" ("+d+"%)<br/><small>"+g+"</small>"}};a.plotOptions={column:{stacking:"normal"},series:{cursor:"pointer",point:{events:{click:function click(){var a=i.attempts_questions[this.x],b=a.id,c=M.cfg.wwwroot+"/question/preview.php?id="+b+"&courseid="+i.courseid;window.open(c,"_blank","top=50,left=50,width=900,height=600");i.saveInteraction(i.questions_attempts_chart,"selected","question",13)}}}}};a.series=this.attempts_series;return a},build_hardest_questions_chart:function build_hardest_questions_chart(){var a={};a.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.hardest_questions_colors;a.xAxis={categories:this.hardest_categories};a.legend={enabled:!1};a.tooltip={useHTML:!0,formatter:function formatter(){var a=this.point.x,b=i.hardest_questions[a],c=this.x,d=this.series.name,e=this.y,f=i.strings.of_conector,g=i.strings.review_question;return"<small>"+c+"</small></br><b style=\"color: "+this.color+";\">\u2022 </b>"+d+": "+b.ha+" "+f+" "+b.to+" ("+e+"%)<br/><small>"+g+"</small>"}};a.yAxis=[{min:0,allowDecimals:!1,title:{text:this.strings.hardest_questions_yaxis_title},labels:{format:"{value} %"}}];a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){var a=i.hardest_questions[this.x],b=a.id,c=M.cfg.wwwroot+"/question/preview.php?id="+b+"&courseid="+i.courseid;window.open(c,"_blank","top=50,left=50,width=900,height=600");i.saveInteraction(i.hardest_questions_chart,"selected","question",13)}}}}};a.series=this.hardest_series;return a},calculate_questions_attempts:function calculate_questions_attempts(a){var b=a.questions,c=[],d=1,e="",f=[],g=[],h=[],i=[],j=[],k=[],l=[],m,n,o,p,q,r,s=0;b.forEach(function(a){m,n,o,p,q,r=0;m=(a.gradedright||0)+(a.mangrright||0);n=(a.gradedpartial||0)+(a.mangrpartial||0);o=(a.gradedwrong||0)+(a.mangrwrong||0);p=(a.gaveup||0)+(a.mangaveup||0);q=(a.needsgrading||0)+(a.mangaveup||0)+(a.finished||0)+(a.manfinished||0);f.push(m);g.push(n);h.push(o);i.push(p);j.push(q);e="P"+d;s=n+o+p;r=m+n+o+p+q;k.push({id:a.id,qu:e,ha:s,to:r,pe:Math.round(100*s/r)});c.push(e);l.push(a);d++});var t=[{name:this.strings.correct_attempt,data:f},{name:this.strings.partcorrect_attempt,data:g},{name:this.strings.incorrect_attempt,data:h},{name:this.strings.blank_attempt,data:i},{name:this.strings.needgraded_attempt,data:j}],u=[],v=[],w=[];k.sort(this.compare_hardest);k.forEach(function(a){if(a.pe){u.push(a.qu);v.push(a.pe);w.push(a)}});var x=[{name:this.strings.hardest_questions_yaxis_title,data:v}];this.attempts_categories=c;this.attempts_series=t;this.attempts_questions=l;this.hardest_categories=u;this.hardest_series=x;this.hardest_questions=w;this.saveInteraction("quiz_selector","selected","quiz",21)},update_interactions:function update_interactions(a){var b=this;this.loading=!0;this.errors=[];var d={action:"quiz",userid:this.userid,courseid:this.courseid,weekcode:a.weekcode,profile:this.render_has,url:window.location.href};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(a){if(200==a.status&&a.data.ok){b.quiz=a.data.data.quiz;if(b.quiz.length){b.default_quiz=b.quiz[0].attempts;b.calculate_questions_attempts(b.default_quiz)}else{b.reset_graphs()}}else{b.error_messages.push(b.strings.error_network)}}).catch(function(){b.errors.push(b.strings.api_error_network)}).finally(function(){b.loading=!1});return this.data},reset_graphs:function reset_graphs(){this.default_quiz=null;this.attempts_categories=[];this.attempts_series=[];this.attempts_questions=[];this.hardest_categories=[];this.hardest_series=[];this.hardest_questions=[]},compare_hardest:function compare_hardest(c,a){if(c.pe>a.pe){return-1}if(c.pe<a.pe){return 1}return 0},openChartHelp:function openChartHelp(a){var b=[];if(a==this.questions_attempts_chart){b.push({title:this.strings.questions_attempts_help_title,description:this.strings.questions_attempts_help_description_p1});b.push({description:this.strings.questions_attempts_help_description_p2});b.push({description:this.strings.questions_attempts_help_description_p3})}else if(a==this.hardest_questions_chart){b.push({title:this.strings.hardest_questions_help_title,description:this.strings.hardest_questions_help_description_p1});b.push({description:this.strings.hardest_questions_help_description_p2});b.push({description:this.strings.hardest_questions_help_description_p3})}this.help_contents=b;if(this.help_contents.length){this.help_dialog=!0;this.saveInteraction(a,"viewed","chart_help_dialog",7)}},saveInteraction:function saveInteraction(a,b,d,e){var f={action:"saveinteraction",pluginsection:this.pluginSectionName,component:a,interaction:b,target:d,url:window.location.href,interactiontype:e,courseid:this.courseid,userid:this.userid};c({method:"get",url:"".concat(M.cfg.wwwroot,"/local/fliplearning/ajax.php"),params:f}).then(function(){}).catch(function(){})},update_help_dialog:function update_help_dialog(a){this.help_dialog=a},get_timezone:function get_timezone(){var a="".concat(this.strings.change_timezone," ").concat(this.timezone);return a}}})}}});
//# sourceMappingURL=quiz.min.js.map
