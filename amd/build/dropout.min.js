define ("local_fliplearning/dropout",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/moment","local_fliplearning/momenttimezone","local_fliplearning/pagination","local_fliplearning/chartdynamic","local_fliplearning/pageheader","local_fliplearning/emailform"],function(a,b,c,d,e,f,g,h){"use strict";return{init:function(d){console.log(d);a.use(b);a.component("pagination",e);a.component("chart",f);a.component("pageheader",g);a.component("emailform",h);var i=new a({delimiters:["[[","]]"],el:"#dropout",vuetify:new b,data:function data(){return{strings:d.strings,groups:d.groups,userid:d.userid,courseid:d.courseid,timezone:d.timezone,render_has:d.profile_render,loading:!1,errors:[],pages:d.pages,dropout:d.dropout,selected_cluster:[],cluster_users:[],selected_user:null,search:null,week_modules_chart_data:[],week_modules_chart_categories:[],selected_sections:[],sessions_evolution_data:[],user_grades_categories:[],user_grades_data:[],course_grades_data:[],modules_dialog:!1,email_users:[],email_dialog:!1,modulename:"",moduleid:!1,email_strings:d.strings.email_strings}},beforeMount:function beforeMount(){if(this.dropout.clusters.length){this.set_modules_in_sections();this.selected_cluster=this.dropout.clusters[0];this.change_cluster(this.selected_cluster.users)}},mounted:function mounted(){document.querySelector("#sessions-loader").style.display="none";document.querySelector("#dropout").style.display="block"},computed:{},methods:{get_help_content:function get_help_content(){return"Texto de Ayuda"},set_modules_in_sections:function set_modules_in_sections(){var a=new Map,b=0;this.dropout.cms.forEach(function(c){b=+c.section;if(!a.has(b)){a.set(b,[c])}else{a.get(b).push(c)}});this.dropout.sections.forEach(function(c){b=+c.sectionid;c.sectionid=b;c.modules=a.get(b)})},change_cluster:function change_cluster(a){var b=[];this.dropout.users.forEach(function(c){if(a.includes(c.id)){b.push(c)}});if(b.length){this.cluster_users=b;var c=this.cluster_users[0];this.change_user(c)}else{this.cluster_users=[];this.selected_user=null}},change_user:function change_user(a){this.selected_user=a;console.log({user:a});this.calculate_modules_access_by_week();this.calculate_sessions_evolution();this.calculate_user_grades()},calculate_modules_access_by_week:function calculate_modules_access_by_week(){var a=this,b=0,c=0,d=0,e=0,f=[],g=[],h=[],i=[],j;this.dropout.weeks.forEach(function(k){d=0,e=0;k.sections.forEach(function(g){b=+g.sectionid;g.sectionid=b;f=a.sections_modules(b);f.forEach(function(b){c=+b.id;b.id=c;j=a.selected_user.cms.modules["cm".concat(b.id)];if(j){j.complete&&d++;j.viewed&&e++}})});g.push(d);h.push(e);i.push("".concat(k.name," ").concat(k.position+1))});this.week_modules_chart_categories=i;this.week_modules_chart_data=[{name:this.strings.modules_access_chart_series_viewed,data:h},{name:this.strings.modules_access_chart_series_complete,data:g}]},calculate_sessions_evolution:function calculate_sessions_evolution(){var a=[],b=[],c=0,d=0,e=0,f=0;this.selected_user.sessions.forEach(function(g){f=1e3*+g.start;e=+g.duration/60;c+=e;d++;a.push({x:f,y:d});b.push({x:f,y:c})});this.sessions_evolution_data=[{name:this.strings.sessions_evolution_chart_legend1,yAxis:0,data:a},{name:this.strings.sessions_evolution_chart_legend2,yAxis:1,data:b}]},calculate_user_grades:function calculate_user_grades(){var a=[],b=[],c=[],d=0,e=this.selected_user.firstname;this.selected_user.gradeitems.forEach(function(e){d=100*+e.finalgrade/+e.grademax;a.push(e.itemname);b.push(e.average_percentage);c.push(d)});this.user_grades_data=[{name:e,data:c},{name:this.strings.user_grades_chart_legend,data:b}];this.user_grades_categories=a},build_modules_access_chart:function build_modules_access_chart(){var a={};a.chart={type:"bar",backgroundColor:"#FAFAFA"};a.subtitle={text:"".concat(this.selected_user.firstname," ").concat(this.selected_user.lastname)};a.title={text:this.strings.modules_access_chart_title};a.xAxis={type:"category"};a.yAxis={allowDecimals:!1,title:{enabled:!0,text:this.strings.modules_amount}};a.tooltip={shared:!0,formatter:function formatter(){var a=1==this.y?i.strings.module_label:i.strings.modules_label;return"<b>"+this.points[0].key+"</b>: "+this.y+" "+a+"<br/><i>"+i.strings.modules_details+"<i/>"}};a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){i.open_modules_modal(this.x)}}}}},a.legend={enabled:!1};a.series=[{colorByPoint:!0,data:[{name:this.strings.modules_access_chart_series_viewed,y:this.selected_user.cms.viewed},{name:this.strings.modules_access_chart_series_complete,y:this.selected_user.cms.complete},{name:this.strings.modules_access_chart_series_total,y:this.selected_user.cms.total}]}];return a},build_week_modules_chart:function build_week_modules_chart(){var a={};a.chart={type:"column",backgroundColor:"#FAFAFA"};a.subtitle={text:"".concat(this.selected_user.firstname," ").concat(this.selected_user.lastname)};a.title={text:this.strings.week_modules_chart_title};a.xAxis={categories:this.week_modules_chart_categories,title:{text:null},crosshair:!0};a.yAxis={allowDecimals:!1,title:{text:this.strings.modules_amount}};a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a="",b="";if(this.points[0]){var c=1==this.points[0].y?i.strings.module_label:i.strings.modules_label,d=this.points[0].series.name;a="<b style=\"color: ".concat(this.points[0].color,"\">").concat(d,": </b>\n                                            ").concat(this.points[0].y," ").concat(c,"<br/>")}if(this.points[1]){var e=1==this.points[1].y?i.strings.module_label:i.strings.modules_label,f=this.points[1].series.name;b="<b style=\"color: ".concat(this.points[1].color,"\">").concat(f,": </b>\n                                            ").concat(this.points[1].y," ").concat(e,"<br/>")}return"".concat(this.x," <br/> ").concat(a).concat(b," <i>").concat(i.strings.modules_details,"<i/>")}};a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){i.open_modules_modal(this.colorIndex,this.x)}}}}};a.series=this.week_modules_chart_data;return a},build_sessions_evolution_chart:function build_sessions_evolution_chart(){var a={};a.chart={zoomType:"x",backgroundColor:"#FAFAFA"};a.subtitle={text:"".concat(this.selected_user.firstname," ").concat(this.selected_user.lastname)};a.title={text:this.strings.sessions_evolution_chart_title};a.xAxis={type:"datetime"};a.yAxis=[{allowDecimals:!1,title:{text:this.strings.sessions_evolution_chart_xaxis1}},{title:{text:this.strings.sessions_evolution_chart_xaxis2},opposite:!0}];a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a=i.calculate_timezone_date_string(this.x),b=this.points[0]?i.get_sessions_evolution_tooltip(this.points[0]):"",c=this.points[1]?i.get_sessions_evolution_tooltip(this.points[1]):"";return"<small>".concat(a,"</small><br/>").concat(b).concat(c)}};a.series=this.sessions_evolution_data;return a},build_user_grades_chart:function build_user_grades_chart(){var a={};a.chart={type:"column",backgroundColor:"#FAFAFA"};a.title={text:this.strings.user_grades_chart_title};a.subtitle={text:"".concat(this.selected_user.firstname," ").concat(this.selected_user.lastname)};a.xAxis={crosshair:!0,categories:this.user_grades_categories};a.yAxis={allowDecimals:!1,title:{text:this.strings.user_grades_chart_yaxis}};a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a=this.x,b=this.points[0].point.x,c=i.selected_user.gradeitems[b],d="<small>".concat(a,"</small><br/>"),e="<i>(".concat(i.strings.user_grades_chart_view_activity,")</i><br/>"),f="";if(0==c.gradecount){f=i.strings.user_grades_chart_tooltip_no_graded}else{var g=this.points[0]?i.get_user_grades_tooltip(this.points[0],c):"",h=this.points[1]?i.get_user_grades_tooltip(this.points[1],c):"";f="".concat(g).concat(h).concat(e)}return"".concat(d).concat(f)}};a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){console.log(this);var a=this.x,b=i.selected_user.gradeitems[a],c="".concat(M.cfg.wwwroot,"/mod/").concat(b.itemmodule,"/view.php?id=").concat(b.coursemoduleid);window.open(c,"_blank")}}}}};a.series=this.user_grades_data;return a},get_sessions_evolution_tooltip:function get_sessions_evolution_tooltip(a){var b="",c,d,e,f,g;if(0==a.colorIndex){c=a.y;d=1==c?i.strings.session_text:i.strings.sessions_text;e=a.series.name;b="<b style=\"color: ".concat(a.color,"\">").concat(e,": </b>\n                                     ").concat(c," ").concat(d,"<br/>")}else{f=a.series.name;g=i.convert_time(60*a.y);b="<b style=\"color: ".concat(a.color,"\">").concat(f,": </b>\n                                    ").concat(g,"<br/>")}return b},get_user_grades_tooltip:function get_user_grades_tooltip(a,b){var c=a.series.name,d=0,e=+b.finalgrade,f=+b.average,g=+b.grademax;g=this.isInt(g)?g:g.toFixed(2);if(0==a.colorIndex){d=this.isInt(e)?e:e.toFixed(2)}else{d=this.isInt(f)?f:f.toFixed(2)}return"<b style=\"color: ".concat(a.color,"\">").concat(c,": </b>\n                                     ").concat(d,"/").concat(g,"<br/>")},calculate_timezone_date_string:function calculate_timezone_date_string(a){var b,d,e,f,g;if(c.tz.zone(this.timezone)){b=c(a).tz(this.timezone);d=b.day();e=b.date();f=b.month();g=b.format("HH:mm:ss")}else{var h=Intl.DateTimeFormat().resolvedOptions().timeZone;b=new Date(a);d=b.getDay();e=b.getDate();f=b.getMonth();g="".concat(b.getHours(),":").concat(b.getMinutes(),":").concat(b.getSeconds()," (").concat(h,")")}d=this.strings.chart.weekdays[d];f=this.strings.chart.shortMonths[f];return"".concat(d,", ").concat(f," ").concat(e,", ").concat(g)},convert_time:function convert_time(a){a*=60;var b=this.strings.hours_short,c=this.strings.minutes_short,d=this.strings.seconds_short,e=Math.floor(a/3600),f=Math.floor(a%3600/60),g=Math.floor(a%60),h;if(1<=e){h="".concat(e).concat(b," ").concat(f).concat(c)}else if(1<=f){h="".concat(f).concat(c," ").concat(g).concat(d)}else{h="".concat(g).concat(d)}return h},open_modules_modal:function open_modules_modal(a,b){var c=this,d=this.dropout.sections;if(Number.isInteger(b)){d=[];var e,f=this.dropout.weeks[b];f.sections.forEach(function(a){e={sectionid:a.sectionid,name:a.name,modules:c.sections_modules(a.sectionid)};d.push(e)})}d.forEach(function(a){a.modules.forEach(function(a){a.complete=!1;a.viewed=!1;a.interactions=0;var b=c.selected_user.cms.modules["cm".concat(a.id)];if(b){a.complete=b.complete;a.viewed=b.viewed;a.interactions=b.interactions}})});this.modules_dialog=!0;this.selected_sections=d},sections_modules:function sections_modules(a){for(var b=[],c=this.dropout.sections,d=0;d<c.length;d++){if(c[d].sectionid==a){b=c[d].modules;break}}return b},get_user_module:function get_user_module(a){for(var b,c=this.selected_user.cms.modules,d=0;d<c.length;d++){c[d].id=+c[d].id;if(c[d].id==a){b=c[d];break}}return b},table_headers:function table_headers(){var a=[{text:"",value:"id",align:"center",sortable:!1},{text:this.strings.thead_name,value:"firstname"},{text:this.strings.thead_lastname,value:"lastname"},{text:this.strings.thead_progress,value:"progress_percentage"}];return a},get_picture_url:function get_picture_url(a){return"".concat(M.cfg.wwwroot,"/user/pix.php?file=/").concat(a,"/f1.jpg")},get_module_icon:function get_module_icon(a){return"".concat(M.cfg.wwwroot,"/theme/image.php/boost/").concat(a,"/1/icon")},get_module_url:function get_module_url(a){return"".concat(M.cfg.wwwroot,"/mod/").concat(a.modname,"/view.php?id=").concat(a.id)},get_interactions_number:function get_interactions_number(a){var b=1==a?this.strings.modules_interaction:this.strings.modules_interactions;return"(".concat(a," ").concat(b,")")},get_user_fullname:function get_user_fullname(){return"".concat(this.selected_user.firstname," ").concat(this.selected_user.lastname)},get_username:function get_username(){return"@".concat(this.selected_user.username)},see_profile:function see_profile(){var a=this.selected_user.id,b=M.cfg.wwwroot+"/user/view.php?id="+a+"&course="+i.courseid;window.open(b)},get_progress_message:function get_progress_message(){var a=this.strings.modules_label,b=this.strings.finisheds_label;if(1==this.selected_user.cms.complete){a=this.strings.module_label;b=this.strings.finished_label}return"".concat(this.selected_user.cms.complete," ").concat(a," ").concat(b," ").concat(this.strings.of_conector," ").concat(this.dropout.total_cms)},get_progress_percentage:function get_progress_percentage(){return"".concat(this.selected_user.progress_percentage," %")},get_student_grade:function get_student_grade(){var a=this.selected_user.coursegrade;a.finalgrade=+a.finalgrade;a.maxgrade=+a.maxgrade;var b=this.isInt(a.finalgrade)?a.finalgrade:a.finalgrade.toFixed(2),c=this.isInt(a.maxgrade)?a.maxgrade:a.maxgrade.toFixed(2);return"".concat(b,"/").concat(c)},get_sendmail_user_text:function get_sendmail_user_text(){return"".concat(this.strings.send_mail_to_user," ").concat(this.selected_user.firstname)},sendmail:function sendmail(a){this.strings.email_strings.subject=this.strings.email_strings.subject_prefix;this.modulename="course";this.moduleid=this.courseid;if(1==a){this.email_users=[this.selected_user];this.email_dialog=!0}else if(2==a){this.email_users=this.cluster_users;this.email_dialog=!0}},update_email_dialog:function update_email_dialog(a){this.email_dialog=a},isInt:function isInt(a){return 0==a%1},get_timezone:function get_timezone(){var a="".concat(this.strings.ss_change_timezone," ").concat(this.timezone);return a}}})}}});
//# sourceMappingURL=dropout.min.js.map
