define ("local_fliplearning/student_sessions",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/moment","local_fliplearning/pagination","local_fliplearning/chartstatic","local_fliplearning/pageheader"],function(a,b,c,d,e,f,g){"use strict";return{init:function(d){console.log(d);a.use(b);a.component("pagination",e);a.component("chart",f);a.component("pageheader",g);var h=new a({delimiters:["[[","]]"],el:"#work_sessions",vuetify:new b,data:function data(){return{strings:d.strings,groups:d.groups,userid:d.userid,courseid:d.courseid,timezone:d.timezone,render_has:d.profile_render,loading:!1,errors:[],pages:d.pages,indicators:d.indicators,inverted_time:d.indicators.inverted_time,hours_sessions:d.indicators.hours_sessions,sections:d.indicators.sections,sections_map:null,week_progress:0,resource_access_categories:[],resource_access_data:[],modules_dialog:!1}},beforeMount:function beforeMount(){this.create_section_map();this.set_modules_in_sections();this.calculate_resources_access()},mounted:function mounted(){document.querySelector("#sessions-loader").style.display="none";document.querySelector("#work_sessions").style.display="block"},methods:{get_help_content:function get_help_content(){return""},build_inverted_time_chart:function build_inverted_time_chart(){var a={};a.chart={type:"bar",backgroundColor:"#FAFAFA"};a.title={text:this.strings.inverted_time_chart_title};a.xAxis={type:"category"};a.yAxis={title:{enabled:!0,text:this.strings.inverted_time_chart_x_axis}};a.tooltip={formatter:function formatter(){return"<b>"+h.strings.inverted_time+": </b>"+h.inverted_time.inverted_time_converted+"<br/><b>"+h.strings.expected_time+": </b>"+h.inverted_time.expected_time_converted+"<br/>"}};a.legend={enabled:!1};a.series=[{colorByPoint:!0,data:this.inverted_time.data}];return a},build_session_by_hours_chart:function build_session_by_hours_chart(){var a={};a.title={text:this.strings.hours_sessions_title};a.chart={type:"heatmap",marginTop:40,marginBottom:80,plotBorderWidth:0,backgroundColor:"#FAFAFA"};a.xAxis={categories:this.strings.days};a.yAxis={categories:this.strings.hours,title:null,reversed:!0};a.colorAxis={min:0,stops:[[0,"#E0E0E0"],[.25,"#D6E7F9"],[.5,"#9AC4EF"],[.75,"#5DA1E5"],[1,"#3384D6"]]};a.legend={layout:"horizontal",margin:30,verticalAlign:"bottom"};a.tooltip={formatter:function formatter(){var a=h.get_point_category_name(this.point,"x"),b=h.get_point_category_name(this.point,"y"),c=h.strings.sessions_text;if(1==this.point.value){c=h.strings.session_text}return"<b>"+a+" "+b+"</b>: "+this.point.value+" "+c}};a.series=[{borderWidth:2,borderColor:"#FAFAFA",data:this.hours_sessions,dataLabels:{enabled:!1}}];return a},build_resources_access_chart:function build_resources_access_chart(){var a={};a.chart={type:"column",backgroundColor:"#FAFAFA"};a.title={text:this.strings.resource_access_title};a.xAxis={categories:this.resource_access_categories,crosshair:!0,title:{text:this.strings.resource_access_x_axis}};a.yAxis={min:0,title:{text:this.strings.resource_access_y_axis}};a.plotOptions={column:{stacking:"normal"},series:{cursor:"pointer",point:{events:{click:function click(){h.modules_dialog=!0}}}}};a.tooltip={shared:!0,useHTML:!0,footerFormat:"<i>".concat(this.strings.modules_details,"</i>")};a.series=this.resource_access_data;return a},update_interactions:function update_interactions(a){var b=this;this.loading=!0;this.errors=[];var d={action:"studentsessions",userid:this.userid,courseid:this.courseid,weekcode:a.weekcode,profile:this.render_has};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(a){if(200==a.status&&a.data.ok){b.inverted_time=a.data.data.indicators.inverted_time;b.hours_sessions=a.data.data.indicators.hours_sessions;b.sections=a.data.data.indicators.sections;b.set_modules_in_sections();b.calculate_resources_access()}else{b.error_messages.push(b.strings.error_network)}}).catch(function(a){console.log(a);b.errors.push(b.strings.api_error_network)}).finally(function(){b.loading=!1});return this.data},create_section_map:function create_section_map(){var a=new Map,b=0;this.indicators.course_cms.forEach(function(c){b=+c.section;if(!a.has(b)){a.set(b,[c])}else{a.get(b).push(c)}});this.sections_map=a},set_modules_in_sections:function set_modules_in_sections(){var a=this,b;this.sections.forEach(function(c){b=+c.sectionid;c.sectionid=b;c.modules=a.sections_map.get(b)})},calculate_resources_access:function calculate_resources_access(){var a=this,b=new Map,c,d,e,f=0,g=0,h=this.strings.modules_names;this.sections.forEach(function(h){h.modules.forEach(function(h){b.has(h.modname)||b.set(h.modname,{complete:0,pending:0});e=b.get(h.modname);c=+h.id;h.id=c;h.complete=!1;h.viewed=!1;h.interactions=0;d=a.indicators.user_cms["cm".concat(h.id)];if(d){h.complete=d.complete;h.viewed=d.viewed;h.interactions=d.interactions;d.complete?e.complete++:e.pending++;d.complete&&g++}else{e.pending++}f++})});var i=[],j=[],k=[];b.forEach(function(a,b){i.push(h[b]||b);j.push(a.complete);k.push(a.pending)});this.resource_access_categories=i;this.resource_access_data=[{name:this.strings.resource_access_legend1,data:j},{name:this.strings.resource_access_legend2,data:k}];this.week_progress=Math.floor(100*g/f)},get_progress_percentage:function get_progress_percentage(){return"".concat(this.week_progress," %")},get_point_category_name:function get_point_category_name(a,b){var c=a.series,d="y"===b,e=c[d?"yAxis":"xAxis"];return e.categories[a[d?"y":"x"]]},get_module_icon:function get_module_icon(a){return"".concat(M.cfg.wwwroot,"/theme/image.php/boost/").concat(a,"/1/icon")},get_module_url:function get_module_url(a){return"".concat(M.cfg.wwwroot,"/mod/").concat(a.modname,"/view.php?id=").concat(a.id)},get_interactions_number:function get_interactions_number(a){var b=1==a?this.strings.modules_interaction:this.strings.modules_interactions;return"(".concat(a," ").concat(b,")")},get_timezone:function get_timezone(){var a="".concat(this.strings.ss_change_timezone," ").concat(this.timezone);return a}}})}}});
//# sourceMappingURL=student_sessions.min.js.map
