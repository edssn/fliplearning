define ("local_fliplearning/student",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/moment","local_fliplearning/momenttimezone","local_fliplearning/pagination","local_fliplearning/chartstatic","local_fliplearning/pageheader","local_fliplearning/modulesform","local_fliplearning/helpdialog"],function(a,b,c,d,e,f,g,h,i,j){"use strict";return{init:function(e){a.use(b);a.component("pagination",f);a.component("chart",g);a.component("pageheader",h);a.component("modulesform",i);a.component("helpdialog",j);var k=new a({delimiters:["[[","]]"],el:"#student_general",vuetify:new b,data:function data(){return{strings:e.strings,groups:e.groups,userid:e.userid,courseid:e.courseid,timezone:e.timezone,render_has:e.profile_render,loading:!1,modules_dialog:!1,errors:[],indicators:e.indicators,weeks_session_colors:e.weeks_session_colors,modules_access_colors:e.modules_access_colors,sessions_evolution_colors:e.sessions_evolution_colors,user_grades_colors:e.user_grades_colors,user:e.indicators.user,weeks_sessions:e.indicators.sessions,sessions_evolution_data:[],user_grades_categories:[],user_grades_data:[],course_grades_data:[],selected_sections:[],help_dialog:!1,help_contents:[],pluginSectionName:"student_general",modules_access_chart:"modules_access_chart",weeks_session_chart:"weeks_session_chart",sessions_evolution_chart:"sessions_evolution_chart",user_grades_chart:"user_grades_chart"}},beforeMount:function beforeMount(){this.set_modules_in_sections();this.calculate_sessions_evolution();this.calculate_user_grades()},mounted:function mounted(){document.querySelector("#student_general_loader").style.display="none";document.querySelector("#student_general").style.display="block"},methods:{get_help_content:function get_help_content(){var a=[{title:this.strings.section_help_title,description:this.strings.section_help_description}];return a},set_modules_in_sections:function set_modules_in_sections(){var a=new Map,b=0;this.indicators.cms.forEach(function(c){b=+c.section;if(!a.has(b)){a.set(b,[c])}else{a.get(b).push(c)}});this.indicators.sections.forEach(function(c){b=+c.sectionid;c.sectionid=b;c.modules=a.has(b)?a.get(b):[]})},build_modules_access_chart:function build_modules_access_chart(){var a={};a.chart={type:"bar",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.modules_access_colors,a.xAxis={type:"category"};a.yAxis={allowDecimals:!1,title:{enabled:!0,text:this.strings.modules_amount}};a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a=k.capitalizeFirstLetter(k.strings.modules_label);return"<small>"+a+"</small><br/><b style=\"color:"+this.points[0].color+";\">\u2022 </b><b>"+this.points[0].key+"</b>: "+this.y+"<br/><small>"+k.strings.modules_details+"</small>"}};a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){k.open_modules_modal(this.x);k.saveInteraction(k.modules_access_chart,"viewed","resources_details_dialog",18)}}}}},a.legend={enabled:!1};a.series=[{colorByPoint:!0,data:[{name:this.strings.modules_access_chart_series_viewed,y:this.user.cms.viewed},{name:this.strings.modules_access_chart_series_complete,y:this.user.cms.complete},{name:this.strings.modules_access_chart_series_total,y:this.user.cms.total}]}];return a},build_weeks_session_chart:function build_weeks_session_chart(){var a={};a.title={text:null};a.chart={type:"heatmap",backgroundColor:null,style:{fontFamily:"poppins"}};a.xAxis={categories:this.strings.weeks};a.yAxis={categories:this.weeks_sessions.categories,title:null,reversed:!0};a.colorAxis={min:0,minColor:this.weeks_session_colors[0],maxColor:this.weeks_session_colors[1]};a.legend={layout:"horizontal",verticalAlign:"bottom"};a.tooltip={useHTML:!0,formatter:function formatter(){var a=k.weeks_sessions.weeks[this.point.y][this.point.x]||"",b=k.get_point_category_name(this.point,"x"),c=k.get_point_category_name(this.point,"y"),d=k.capitalizeFirstLetter(k.strings.sessions_text);return"<small>"+c+" "+b+"</small><br/><b style=\"color: "+k.weeks_session_colors[1]+";\">\u2022 </b>"+d+": "+this.point.value+"<br/><small>"+a+"</small>"}};a.series=[{borderWidth:2,borderColor:"#FAFAFA",data:this.weeks_sessions.data}];return a},build_sessions_evolution_chart:function build_sessions_evolution_chart(){var a={};a.chart={zoomType:"x",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.sessions_evolution_colors,a.xAxis={type:"datetime"};a.yAxis=[{allowDecimals:!1,title:{text:this.strings.sessions_evolution_chart_xaxis1}},{title:{text:this.strings.sessions_evolution_chart_xaxis2},opposite:!0}];a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a=k.calculate_timezone_date_string(this.x),b=this.points[0]?k.get_sessions_evolution_tooltip(this.points[0]):"",c=this.points[1]?k.get_sessions_evolution_tooltip(this.points[1]):"";return"<small>".concat(a,"</small><br/>").concat(b).concat(c)}};a.series=this.sessions_evolution_data;return a},build_user_grades_chart:function build_user_grades_chart(){var a={};a.chart={type:"column",backgroundColor:null,style:{fontFamily:"poppins"}};a.title={text:null};a.colors=this.user_grades_colors,a.xAxis={crosshair:!0,categories:this.user_grades_categories};a.yAxis={allowDecimals:!1,max:100,labels:{format:"{value} %"},title:{text:this.strings.user_grades_chart_yaxis}};a.tooltip={shared:!0,useHTML:!0,formatter:function formatter(){var a=this.x,b=this.points[0].point.x,c=k.user.gradeitems[b],d="<small>".concat(a,"</small><br/>"),e="<small>(".concat(k.strings.user_grades_chart_view_activity,")</small><br/>"),f="";if(0==c.gradecount){f=k.strings.user_grades_chart_tooltip_no_graded}else{var g=this.points[0]?k.get_user_grades_tooltip(this.points[0],c):"",h=this.points[1]?k.get_user_grades_tooltip(this.points[1],c):"";f="".concat(g).concat(h).concat(e)}return"".concat(d).concat(f)}};a.plotOptions={series:{cursor:"pointer",point:{events:{click:function click(){var a=this.x,b=k.user.gradeitems[a],c="".concat(M.cfg.wwwroot,"/mod/").concat(b.itemmodule,"/view.php?id=").concat(b.coursemoduleid);window.open(c,"_blank");k.saveInteraction(k.user_grades_chart,"selected","grade_item",19)}}}}};a.series=this.user_grades_data;return a},calculate_sessions_evolution:function calculate_sessions_evolution(){var a=[],b=[],c=0,d=0,e=0,f=0;this.user.sessions.forEach(function(g){f=1e3*+g.start;e=+g.duration/60;c+=e;d++;a.push({x:f,y:d});b.push({x:f,y:c})});this.sessions_evolution_data=[{name:this.strings.sessions_evolution_chart_legend1,yAxis:0,data:a},{name:this.strings.sessions_evolution_chart_legend2,yAxis:1,data:b}]},calculate_user_grades:function calculate_user_grades(){var a=[],b=[],c=[],d=0,e=this.user.firstname;if(this.user.gradeitems){this.user.gradeitems.forEach(function(e){d=100*+e.finalgrade/+e.grademax;a.push(e.itemname);b.push(e.average_percentage);c.push(d)});this.user_grades_data=[{name:e,data:c},{name:this.strings.user_grades_chart_legend,data:b}];this.user_grades_categories=a}},calculate_timezone_date_string:function calculate_timezone_date_string(a){var b,c,e,f,g;if(d.tz.zone(this.timezone)){b=d(a).tz(this.timezone);c=b.day();e=b.date();f=b.month();g=b.format("HH:mm:ss")}else{var h=Intl.DateTimeFormat().resolvedOptions().timeZone;b=new Date(a);c=b.getDay();e=b.getDate();f=b.getMonth();g="".concat(b.getHours(),":").concat(b.getMinutes(),":").concat(b.getSeconds()," (").concat(h,")")}c=this.strings.chart.weekdays[c];f=this.strings.chart.shortMonths[f];return"".concat(c,", ").concat(f," ").concat(e,", ").concat(g)},get_point_category_name:function get_point_category_name(a,b){var c=a.series,d="y"===b,e=c[d?"yAxis":"xAxis"];return e.categories[a[d?"y":"x"]]},get_sessions_evolution_tooltip:function get_sessions_evolution_tooltip(a){var b="",c,d,e,f;if(0==a.colorIndex){c=a.y;d=a.series.name;b="<b style=\"color: ".concat(a.color,";\">\u2022 </b>\n                                    <b>").concat(d,": </b>").concat(c,"<br/>")}else{e=a.series.name;f=this.convert_time(60*a.y);b="<b style=\"color: ".concat(a.color,";\">\u2022 </b>\n                                    <b>").concat(e,": </b>\n                                    ").concat(f,"<br/>")}return b},get_user_grades_tooltip:function get_user_grades_tooltip(a,b){var c=a.series.name,d=0,e=+b.finalgrade,f=+b.average,g=+b.grademax;g=this.isInt(g)?g:g.toFixed(2);if(0==a.colorIndex){d=this.isInt(e)?e:e.toFixed(2)}else{d=this.isInt(f)?f:f.toFixed(2)}return"<b style=\"color: ".concat(a.color,";\">\u2022 </b>\n                                <b>").concat(c,": </b>").concat(d,"/").concat(g,"<br/>")},open_modules_modal:function open_modules_modal(){var a=this,b=this.indicators.sections;b.forEach(function(b){b.modules.forEach(function(b){b.complete=!1;b.viewed=!1;b.interactions=0;var c=a.user.cms.modules["cm".concat(b.id)];if(c){b.complete=c.complete;b.viewed=c.viewed;b.interactions=c.interactions}})});this.modules_dialog=!0;this.selected_sections=b},get_picture_url:function get_picture_url(a){return"".concat(M.cfg.wwwroot,"/user/pix.php?file=/").concat(a,"/f1.jpg")},get_user_fullname:function get_user_fullname(){return"".concat(this.user.firstname," ").concat(this.user.lastname)},get_username:function get_username(){return"@".concat(this.user.username)},see_profile:function see_profile(){var a=this.user.id,b=M.cfg.wwwroot+"/user/view.php?id="+a+"&course="+k.courseid;window.open(b)},get_progress_percentage:function get_progress_percentage(){return"".concat(this.user.progress_percentage," %")},get_progress_message:function get_progress_message(){var a=this.strings.finished_resources;return"".concat(a,": ").concat(this.user.cms.complete," ").concat(this.strings.of_conector," ").concat(this.user.cms.total)},convert_time:function convert_time(a){a*=60;var b=this.strings.hours_short,c=this.strings.minutes_short,d=this.strings.seconds_short,e=Math.floor(a/3600),f=Math.floor(a%3600/60),g=Math.floor(a%60),h;if(1<=e){if(1<=f){h="".concat(e).concat(b," ").concat(f).concat(c)}else{h="".concat(e).concat(b)}}else if(1<=f){if(1<=g){h="".concat(f).concat(c," ").concat(g).concat(d)}else{h="".concat(f).concat(c)}}else{h="".concat(g).concat(d)}return h},get_student_grade:function get_student_grade(){var a=this.user.coursegrade;a.finalgrade=+a.finalgrade;a.maxgrade=+a.maxgrade;var b=this.isInt(a.finalgrade)?a.finalgrade:a.finalgrade.toFixed(2),c=this.isInt(a.maxgrade)?a.maxgrade:a.maxgrade.toFixed(2);return"".concat(b,"/").concat(c)},update_modules_dialog:function update_modules_dialog(a){this.modules_dialog=a},isInt:function isInt(a){return 0==a%1},capitalizeFirstLetter:function capitalizeFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)},openChartHelp:function openChartHelp(a){var b=[];if(a==this.modules_access_chart){b.push({title:this.strings.modules_access_help_title,description:this.strings.modules_access_help_description_p1});b.push({description:this.strings.modules_access_help_description_p2});b.push({description:this.strings.modules_access_help_description_p3})}else if(a==this.weeks_session_chart){b.push({title:this.strings.weeks_session_help_title,description:this.strings.weeks_session_help_description_p1});b.push({description:this.strings.weeks_session_help_description_p2})}else if(a==this.sessions_evolution_chart){b.push({title:this.strings.sessions_evolution_help_title,description:this.strings.sessions_evolution_help_description_p1});b.push({description:this.strings.sessions_evolution_help_description_p2});b.push({description:this.strings.sessions_evolution_help_description_p3})}else if(a==this.user_grades_chart){b.push({title:this.strings.user_grades_help_title,description:this.strings.user_grades_help_description_p1});b.push({description:this.strings.user_grades_help_description_p2});b.push({description:this.strings.user_grades_help_description_p3})}this.help_contents=b;if(this.help_contents.length){this.help_dialog=!0;this.saveInteraction(a,"viewed","chart_help_dialog",7)}},saveInteraction:function saveInteraction(a,b,d,e){var f={action:"saveinteraction",pluginsection:this.pluginSectionName,component:a,interaction:b,target:d,url:window.location.href,interactiontype:e,courseid:this.courseid,userid:this.userid};c({method:"get",url:"".concat(M.cfg.wwwroot,"/local/fliplearning/ajax.php"),params:f}).then(function(){}).catch(function(){})},update_help_dialog:function update_help_dialog(a){this.help_dialog=a},get_timezone:function get_timezone(){var a="".concat(this.strings.change_timezone," ").concat(this.timezone);return a}}})}}});
//# sourceMappingURL=student.min.js.map
