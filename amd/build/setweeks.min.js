define ("local_fliplearning/setweeks",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/sortablejs","local_fliplearning/draggable","local_fliplearning/datepicker","local_fliplearning/moment","local_fliplearning/alertify","local_fliplearning/pageheader"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){for(var b=0,c;b<a.weeks.length;b++){c=a.weeks[b];if("undefined"==typeof c.collapsabled){c.collapsabled=!1}}return a}return{init:function(d){d=j(d);a.use(b);a.component("draggable",e);a.component("datepicker",f);a.component("pageheader",i);new a({delimiters:["[[","]]"],el:"#setweeks",vuetify:new b,data:{display_settings:!1,settings:d.settings,new_group:!1,scroll_mode:!1,weeks_started_at:new Date(g(1e3*+d.weeks[0].weekstart)),strings:d.strings,sections:d.sections,courseid:d.courseid,userid:d.userid,raw_weeks:d.weeks,disabled_dates:{days:[0,2,3,4,5,6]},saving_loader:!1,error_messages:[],save_successful:!1},mounted:function mounted(){document.querySelector("#setweeks-loader").style.display="none";document.querySelector("#setweeks").style.display="block"},computed:{weeks:function weeks(){for(var a=0,b;a<this.raw_weeks.length;a++){b=this.raw_weeks[a];if(0==a){var c=this.weeks_started_at;b.weekstart=c;b.weekend=this.get_end_week(this.weeks_started_at)}else{b.weekstart=this.get_start_week(this.raw_weeks[a-1].weekend);b.weekend=this.get_end_week(b.weekstart)}}return this.raw_weeks}},methods:{section_name:function section_name(a){var b=null;if("undefined"!=typeof a.section_name&&0<a.section_name.length){b=a.section_name}else{b=a.name}return b},section_exist:function section_exist(a){var b=!0;if("undefined"!=typeof a&&"undefined"!=typeof a.exists&&!1==a.exists){b=!1}return b},format_name:function format_name(a,b){return a+" "+(b+1)},customFormatter:function customFormatter(a){var b=g(a).format("YYYY-MM-DD");return b},add_week:function add_week(){this.raw_weeks.push({name:this.strings.week,position:this.weeks.length+1,weekstart:null,weekend:null,collapsabled:!1,hours_dedications:0,removable:!0,sections:[]})},has_items:function has_items(a){return 0<a.length},remove_week:function remove_week(a,b){if(0==b){return null}this.close_delete_confirm();for(var d=0;d<a.sections.length;d++){this.sections.push(a.sections[d])}var c=this.raw_weeks.indexOf(a);this.raw_weeks.splice(c,1)},ask_delete_confirm:function ask_delete_confirm(){this.delete_confirm=!0},close_delete_confirm:function close_delete_confirm(){this.delete_confirm=!1},get_start_week:function get_start_week(a){var b=g(g(a).add(1,"days")).format("YYYY-MM-DD");return b},get_end_week:function get_end_week(a){var b=g(g(a).add(6,"days")).format("YYYY-MM-DD");return b},get_date_next_day:function get_date_next_day(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;a=a.toLowerCase();var d=g(b).format("dddd").toLowerCase();while(d!=a){b=g(b).add(1,"days");d=g(b).format("dddd").toLowerCase()}if(c){b=b.format(c)}else{if("number"!=typeof b){b=parseInt(b.format("x"))}}return b},position:function position(a){a++;return"".concat(a," - ")},save_changes:function save_changes(){var a=this;this.save_successful=!1;this.error_messages=[];if(this.empty_weeks()){this.saving_loader=!1;h.error(this.strings.error_empty_week);this.error_messages.push(this.strings.error_empty_week);return!1}if(this.weeks_deleted_from_course()){this.saving_loader=!1;this.error_messages.push(this.strings.error_section_removed);return!1}h.confirm(this.strings.save_warning_content,function(){a.saving_loader=!0;var b=a.weeks;b[0].weekstart=g(b[0].weekstart).format("YYYY-MM-DD");var d={action:"saveconfigweek",userid:a.userid,courseid:a.courseid,newinstance:a.new_group,weeks:a.minify_query(b)};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(b){if(200==b.status&&b.data.ok){a.settings=b.data.data.settings;h.success(a.strings.save_successful);a.save_successful=!0}else{h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}}).catch(function(){h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}).finally(function(){a.saving_loader=!1})},function(){a.saving_loader=!1;h.warning(a.strings.cancel_action)}).set({title:this.strings.save_warning_title}).set({labels:{cancel:this.strings.confirm_cancel,ok:this.strings.confirm_ok}})},minify_query:function minify_query(a){var b=[];a.forEach(function(a){var c={};c.h=a.hours_dedications;c.s=a.weekstart;c.e=a.weekend;c.sections=[];a.sections.forEach(function(a){var b={};b.sid=a.sectionid;c.sections.push(b)});b.push(c)});return JSON.stringify(b)},empty_weeks:function empty_weeks(){if(2<=this.weeks.length&&1>this.weeks[0].sections.length){return!0}for(var a=0;a<this.weeks.length;a++){if(0<a&&0>=this.weeks[a].sections.length){return!0}}return!1},weeks_deleted_from_course:function weeks_deleted_from_course(){for(var a=0;a<this.weeks.length;a++){for(var b=0;b<this.weeks[a].sections.length;b++){if(!this.section_exist(this.weeks[a].sections[b])){return!0}}}return!1},exists_mistakes:function(){var a=0<this.error_messages.length;return a},change_collapsabled:function change_collapsabled(a){this.raw_weeks[a].collapsabled=!this.raw_weeks[a].collapsabled},course_finished:function course_finished(){var a=!1,b=this.weeks.length-1,c=g(this.weeks[b].weekend).format("X"),d=g().format("X");if(d>c){a=!0}else{a=!1}return a},get_settings_status:function get_settings_status(){var a=this,b=!0;Object.keys(this.settings).map(function(c){if(!a.settings[c]){b=!1}});var c=b?this.strings.plugin_visible:this.strings.plugin_hidden;return c},get_help_content:function get_help_content(){var a=[],b={};b.title=this.strings.title;b.description=this.strings.description;a.push(b);return a}}})}}});
//# sourceMappingURL=setweeks.min.js.map
