define ("local_fliplearning/setweeks",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/sortablejs","local_fliplearning/draggable","local_fliplearning/datepicker","local_fliplearning/moment","local_fliplearning/alertify","local_fliplearning/pageheader"],function(a,b,c,d,e,f,g,h,i){"use strict";return{init:function(d){a.use(b);a.component("draggable",e);a.component("datepicker",f);a.component("pageheader",i);new a({delimiters:["[[","]]"],el:"#setweeks",vuetify:new b,data:{display_settings:!1,settings:d.settings,new_group:!1,scroll_mode:!1,strings:d.strings,sections:d.sections,sectionsWithCms:d.sectionsWithCms,courseid:d.courseid,userid:d.userid,raw_weeks:d.weeks,disabled_dates:{days:[0,2,3,4,5,6]},saving_loader:!1,error_messages:[],save_successful:!1,dates:[],datesLabels:[],previousRangeStart:null},beforeMount:function beforeMount(){if(this.raw_weeks.length){this.setModulesInSections()}},mounted:function mounted(){this.initBlockDates();document.querySelector("#setweeks-loader").style.display="none";document.querySelector("#setweeks").style.display="block"},computed:{dateRangeText:function dateRangeText(){var a=this;return function(b){var c=a.raw_weeks[b].dates.map(function(a){return new Date(a)});c.sort(a.sortDates);c=c.map(function(b){return a.formatDate(b)});a.raw_weeks[b].weekstart=c[0].split("/").reverse().join("-");a.raw_weeks[b].weekend=c[1]?c[1].split("/").reverse().join("-"):a.raw_weeks[b].weekstart;return c.join(" \u2192 ")}},totalTime:function totalTime(){var b=this;return function(a,c){var d=0;b.raw_weeks[a].sections[c].cms.forEach(function(c){d=d+b.isNumber(c.hoursDedication)});return d}}},methods:{section_name:function section_name(a){var b=null;if("undefined"!=typeof a.section_name&&0<a.section_name.length){b=a.section_name}else{b=a.name}return b},section_exist:function section_exist(a){var b=!0;if("undefined"!=typeof a&&"undefined"!=typeof a.exists&&!1==a.exists){b=!1}return b},format_name:function format_name(a,b){return a+" "+(b+1)},customFormatter:function customFormatter(a){var b=g(a).format("YYYY-MM-DD");return b},addWeek:function addWeek(){var a=this.raw_weeks.length,b=this.raw_weeks[a-1].dates[1],c=this.addDays(new Date(b),1),d=this.addDays(new Date(c),6);this.raw_weeks.push({name:this.strings.week,position:this.raw_weeks.length+1,weekstart:c,weekend:d,collapsabled:!1,hours_dedications:0,removable:!0,sections:[],cmsTimeDialog:!1,dates:[c,d],modal:!1,blockDate:c})},remove_week:function remove_week(a,b){if(0==b){return null}for(var d=0;d<a.sections.length;d++){this.sections.push(a.sections[d])}var c=this.raw_weeks.indexOf(a);this.raw_weeks.splice(c,1)},position:function position(a){a++;return"".concat(a," - ")},save_changes:function save_changes(){var a=this;this.save_successful=!1;this.error_messages=[];if(this.empty_weeks()){this.saving_loader=!1;h.error(this.strings.error_empty_week);this.error_messages.push(this.strings.error_empty_week);return!1}if(this.weeks_deleted_from_course()){this.saving_loader=!1;this.error_messages.push(this.strings.error_section_removed);return!1}h.confirm(this.strings.save_warning_content,function(){a.saving_loader=!0;var b=a.raw_weeks,d={action:"saveconfigweek",userid:a.userid,courseid:a.courseid,newinstance:a.new_group,weeks:a.minify_query(b),url:window.location.href};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(b){if(200==b.status&&b.data.ok){a.settings=b.data.data.settings;h.success(a.strings.save_successful);a.save_successful=!0}else{h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}}).catch(function(){h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}).finally(function(){a.saving_loader=!1})},function(){a.saving_loader=!1;h.warning(a.strings.cancel_action)}).set({title:this.strings.save_warning_title}).set({labels:{cancel:this.strings.confirm_cancel,ok:this.strings.confirm_ok}})},minify_query:function minify_query(a){var b=[];a.forEach(function(a){var c={};c.h=a.hours_dedications;c.s=a.weekstart;c.e=a.weekend;c.sections=[];a.sections.forEach(function(a){var b={};b.sid=a.sectionid;c.sections.push(b)});b.push(c)});return JSON.stringify(b)},empty_weeks:function empty_weeks(){if(2<=this.raw_weeks.length&&1>this.raw_weeks[0].sections.length){return!0}for(var a=0;a<this.raw_weeks.length;a++){if(0<a&&0>=this.raw_weeks[a].sections.length){return!0}}return!1},weeks_deleted_from_course:function weeks_deleted_from_course(){for(var a=0;a<this.raw_weeks.length;a++){for(var b=0;b<this.raw_weeks[a].sections.length;b++){if(!this.section_exist(this.raw_weeks[a].sections[b])){return!0}}}return!1},exists_mistakes:function(){var a=0<this.error_messages.length;return a},change_collapsabled:function change_collapsabled(a){this.raw_weeks[a].collapsabled=!this.raw_weeks[a].collapsabled},course_finished:function course_finished(){var a=!1,b=this.raw_weeks.length-1,c=g(this.raw_weeks[b].dates[1]).format("X"),d=g().format("X");if(d>c){a=!0}else{a=!1}return a},sortDates:function sortDates(c,a){return a.getTime()>c.getTime()?-1:a.getTime()<c.getTime()?1:0},formatDate:function formatDate(a){var b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=10>c?"0".concat(c):c,e=a.getUTCDate(),f=10>e?"0".concat(e):e;return"".concat(f,"/").concat(d,"/").concat(b)},saveWeek:function saveWeek(a,b){var c=a[1==a.length?0:1],d=this.addDays(new Date(c),6);this.raw_weeks[b].dates=[c,d];this.raw_weeks[b].modal=!1;var e=new Date(this.previousRangeStart),f=new Date(this.raw_weeks[b].dates[0]),g=Math.ceil((f-e)/86400000),h,j,k,l;for(h=b+1;h<this.raw_weeks.length;h++){j=this.raw_weeks[h].dates.map(function(a){return new Date(a)});k=this.addDays(j[0],g);l=this.addDays(j[1],g);this.raw_weeks[h].dates=[k,l];this.raw_weeks[h].blockDate=this.addDays(new Date(this.raw_weeks[h-1].dates[1]),1)}},addDays:function addDays(a,b){var c=new Date(a.setDate(a.getDate()+b));return c.toISOString().substr(0,10)},savePreviousRangeStart:function savePreviousRangeStart(a){this.previousRangeStart=this.raw_weeks[a].dates[0]},get_help_content:function get_help_content(){var a=[],b={};b.title=this.strings.help_title;b.description=this.strings.help_description;a.push(b);return a},initBlockDates:function initBlockDates(){if(1<this.raw_weeks.length){for(var a=1;a<this.raw_weeks.length;a++){this.raw_weeks[a].blockDate=this.addDays(new Date(this.raw_weeks[a-1].weekend),1)}}},setModulesInSections:function setModulesInSections(){var a,b,c;for(a=0;a<this.raw_weeks.length;a++){this.raw_weeks[a].cmsTimeDialog=!1;for(b=0;b<this.raw_weeks[a].sections.length;b++){c="sid".concat(this.raw_weeks[a].sections[b].sectionid);this.raw_weeks[a].sections[b].cms=this.sectionsWithCms[c]}}for(a=0;a<this.sections.length;a++){c="sid".concat(this.sections[a].sectionid);this.sections[a].cms=this.sectionsWithCms[c]}},isNumber:function isNumber(a){if(""===a){return 0}if(isNaN(a)){return 0}return parseInt(a)},getModuleIcon:function getModuleIcon(a){return"".concat(M.cfg.wwwroot,"/theme/image.php/boost/").concat(a,"/1/icon")},getModuleUrl:function getModuleUrl(a){return"".concat(M.cfg.wwwroot,"/mod/").concat(a.modname,"/view.php?id=").concat(a.id)},saveCourseModulesTime:function saveCourseModulesTime(a,b){var c=this,d=0;this.raw_weeks[b].sections.forEach(function(a){a.cms.forEach(function(a){d=d+c.isNumber(a.hoursDedication)})});this.raw_weeks[b].hours_dedications=this.isNumber(d);a.value=!1}}})}}});
//# sourceMappingURL=setweeks.min.js.map
