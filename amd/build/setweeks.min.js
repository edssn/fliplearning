define ("local_fliplearning/setweeks",["local_fliplearning/vue","local_fliplearning/vuetify","local_fliplearning/axios","local_fliplearning/sortablejs","local_fliplearning/draggable","local_fliplearning/datepicker","local_fliplearning/moment","local_fliplearning/alertify","local_fliplearning/pageheader"],function(a,b,c,d,e,f,g,h,i){"use strict";return{init:function(d){console.log(d);a.use(b);a.component("draggable",e);a.component("datepicker",f);a.component("pageheader",i);new a({delimiters:["[[","]]"],el:"#setweeks",vuetify:new b,data:{display_settings:!1,settings:d.settings,new_group:!1,scroll_mode:!1,strings:d.strings,sections:d.sections,courseid:d.courseid,userid:d.userid,raw_weeks:d.weeks,disabled_dates:{days:[0,2,3,4,5,6]},saving_loader:!1,error_messages:[],save_successful:!1,dates:[],datesLabels:[],modal:!1,modalDatePicker:!1},mounted:function mounted(){this.initBlockDates();document.querySelector("#setweeks-loader").style.display="none";document.querySelector("#setweeks").style.display="block"},computed:{dateRangeText:function dateRangeText(){var a=this;return function(b){var c=a.raw_weeks[b].dates.map(function(a){return new Date(a)});c.sort(a.sortDates);c=c.map(function(b){return a.formatDate(b)});a.raw_weeks[b].weekstart=c[0].split("/").reverse().join("-");a.raw_weeks[b].weekend=c[1]?c[1].split("/").reverse().join("-"):a.raw_weeks[b].weekstart;return c.join(" \u2192 ")}}},methods:{section_name:function section_name(a){var b=null;if("undefined"!=typeof a.section_name&&0<a.section_name.length){b=a.section_name}else{b=a.name}return b},section_exist:function section_exist(a){var b=!0;if("undefined"!=typeof a&&"undefined"!=typeof a.exists&&!1==a.exists){b=!1}return b},format_name:function format_name(a,b){return a+" "+(b+1)},customFormatter:function customFormatter(a){var b=g(a).format("YYYY-MM-DD");return b},add_week:function add_week(){var a=this.get_start_week(new Date(this.get_last_date())),b=this.get_end_week(new Date(a),6);this.raw_weeks.push({name:this.strings.week,position:this.raw_weeks.length+1,weekstart:a,weekend:b,collapsabled:!1,hours_dedications:0,removable:!0,sections:[],dates:[a,b],modal:!1,blockDate:a})},has_items:function has_items(a){return 0<a.length},remove_week:function remove_week(a,b){if(0==b){return null}this.close_delete_confirm();for(var d=0;d<a.sections.length;d++){this.sections.push(a.sections[d])}var c=this.raw_weeks.indexOf(a);this.raw_weeks.splice(c,1)},ask_delete_confirm:function ask_delete_confirm(){this.delete_confirm=!0},close_delete_confirm:function close_delete_confirm(){this.delete_confirm=!1},get_date_next_day:function get_date_next_day(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;a=a.toLowerCase();var d=g(b).format("dddd").toLowerCase();while(d!=a){b=g(b).add(1,"days");d=g(b).format("dddd").toLowerCase()}if(c){b=b.format(c)}else{if("number"!=typeof b){b=parseInt(b.format("x"))}}return b},position:function position(a){a++;return"".concat(a," - ")},save_changes:function save_changes(){var a=this;console.log(this.raw_weeks);this.save_successful=!1;this.error_messages=[];if(this.empty_weeks()){this.saving_loader=!1;h.error(this.strings.error_empty_week);this.error_messages.push(this.strings.error_empty_week);return!1}if(this.weeks_deleted_from_course()){this.saving_loader=!1;this.error_messages.push(this.strings.error_section_removed);return!1}h.confirm(this.strings.save_warning_content,function(){a.saving_loader=!0;var b=a.raw_weeks,d={action:"saveconfigweek",userid:a.userid,courseid:a.courseid,newinstance:a.new_group,weeks:a.minify_query(b),url:window.location.href};c({method:"get",url:M.cfg.wwwroot+"/local/fliplearning/ajax.php",params:d}).then(function(b){if(200==b.status&&b.data.ok){console.log(b.data.data.settings);a.settings=b.data.data.settings;h.success(a.strings.save_successful);a.save_successful=!0}else{h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}}).catch(function(){h.error(a.strings.error_network);a.error_messages.push(a.strings.error_network)}).finally(function(){a.saving_loader=!1})},function(){a.saving_loader=!1;h.warning(a.strings.cancel_action)}).set({title:this.strings.save_warning_title}).set({labels:{cancel:this.strings.confirm_cancel,ok:this.strings.confirm_ok}})},minify_query:function minify_query(a){var b=[];a.forEach(function(a){var c={};c.h=a.hours_dedications;c.s=a.weekstart;c.e=a.weekend;c.sections=[];a.sections.forEach(function(a){var b={};b.sid=a.sectionid;c.sections.push(b)});b.push(c)});return JSON.stringify(b)},empty_weeks:function empty_weeks(){if(2<=this.raw_weeks.length&&1>this.raw_weeks[0].sections.length){return!0}for(var a=0;a<this.raw_weeks.length;a++){if(0<a&&0>=this.raw_weeks[a].sections.length){return!0}}return!1},weeks_deleted_from_course:function weeks_deleted_from_course(){for(var a=0;a<this.raw_weeks.length;a++){for(var b=0;b<this.raw_weeks[a].sections.length;b++){if(!this.section_exist(this.raw_weeks[a].sections[b])){return!0}}}return!1},exists_mistakes:function(){var a=0<this.error_messages.length;return a},change_collapsabled:function change_collapsabled(a){this.raw_weeks[a].collapsabled=!this.raw_weeks[a].collapsabled},course_finished:function course_finished(){var a=!1,b=this.raw_weeks.length-1,c=g(this.raw_weeks[b].dates[1]).format("X"),d=g().format("X");if(d>c){a=!0}else{a=!1}return a},get_settings_status:function get_settings_status(){var a=this,b=!0;Object.keys(this.settings).map(function(c){if(!a.settings[c]){b=!1}});var c=b?this.strings.tw_plugin_visible:this.strings.tw_plugin_hidden;return c},sortDates:function sortDates(c,a){return a.getTime()>c.getTime()?-1:a.getTime()<c.getTime()?1:0},formatDate:function formatDate(a){var b=a.getUTCFullYear(),c=a.getUTCMonth()+1,d=10>c?"0".concat(c):c,e=a.getUTCDate(),f=10>e?"0".concat(e):e;return"".concat(f,"/").concat(d,"/").concat(b)},get_help_content:function get_help_content(){var a=[],b={};b.title=this.strings.help_title;b.description=this.strings.help_description;a.push(b);return a},get_start_week:function get_start_week(a){var b=new Date(a.setDate(a.getDate()+1));return b.toISOString().substr(0,10)},get_end_week:function get_end_week(a,b){var c=new Date(a.setDate(a.getDate()+b));return c.toISOString().substr(0,10)},get_last_date:function get_last_date(){return this.raw_weeks[this.raw_weeks.length-1].dates[1===this.raw_weeks[this.raw_weeks.length-1].dates.length?0:1]},saveWeek:function saveWeek(a){this.raw_weeks[a].modal=!1;for(var j=a+1;j<this.raw_weeks.length;j++){var b=this.raw_weeks[j].dates.map(function(a){return new Date(a)}),c=0;if(1<b.length){var i=Math.abs(b[0]-b[1]);c=Math.ceil(i/86400000)}var k=this.raw_weeks[j-1].dates.map(function(a){return new Date(a)});k.sort(this.sortDates);var d=k.map(function(a){return a.toISOString().substr(0,10)}),e=this.raw_weeks[j],f=d[1===d.length?0:1],g=this.get_start_week(new Date(f)),h=this.get_end_week(new Date(g),c);e.dates=[g,h];this.raw_weeks[j].blockDate=this.get_end_week(new Date(this.raw_weeks[j-1].weekend),1)}},initBlockDates:function initBlockDates(){if(1<this.raw_weeks.length){for(var a=1;a<this.raw_weeks.length;a++){this.raw_weeks[a].blockDate=this.get_end_week(new Date(this.raw_weeks[a-1].weekend),1)}}}}})}}});
//# sourceMappingURL=setweeks.min.js.map
