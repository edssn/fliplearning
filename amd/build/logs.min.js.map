{"version":3,"sources":["../src/logs.js"],"names":["define","Vue","Vuetify","Axios","Alertify","PageHeader","init","content","console","log","defaults","timeout","use","component","delimiters","el","vuetify","data","strings","courseId","userId","timezone","dates","datesLabels","loadingBtnFliplearningLogs","loadingBtnMoodleLogs","mounted","document","querySelector","style","display","computed","dateRangeText","dates_array","map","date","Date","sort","sortDates","formatDate","join","methods","getHelpContent","contents","title","sectionHelpTitle","description","sectionHelpDescription","getFile","type","length","error","startdate","split","reverse","enddate","action","logstype","userid","courseid","method","url","M","cfg","wwwroot","params","then","response","status","ok","filename","message","link","createElement","href","click","success","successDownload","apiErrorNetwork","catch","finally","a","b","getTime","year","getUTCFullYear","month_number","getUTCMonth","month","day_number","getUTCDate","day","getTimezone","information","changeTimezone"],"mappings":"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","sourcesContent":["define([\"local_fliplearning/vue\",\r\n        \"local_fliplearning/vuetify\",\r\n        \"local_fliplearning/axios\",\r\n        \"local_fliplearning/alertify\",\r\n        \"local_fliplearning/pageheader\",\r\n    ],\r\n    function(Vue, Vuetify, Axios, Alertify, PageHeader) {\r\n        \"use strict\";\r\n\r\n        function init(content) {\r\n            console.log(content);\r\n\r\n            const timeout = 60 * 120 * 1000;\r\n            Axios.defaults.timeout = timeout;\r\n\r\n            Vue.use(Vuetify);\r\n            Vue.component('pageheader', PageHeader);\r\n            const app = new Vue({\r\n                delimiters: [\"[[\", \"]]\"],\r\n                el: \"#logs\",\r\n                vuetify: new Vuetify(),\r\n                data: {\r\n                    strings: content.strings,\r\n                    courseId: content.courseId,\r\n                    userId: content.userId,\r\n                    timezone: content.timezone,\r\n\r\n                    dates: [],\r\n                    datesLabels: [],\r\n\r\n                    loadingBtnFliplearningLogs: false,\r\n                    loadingBtnMoodleLogs: false,\r\n                },\r\n                mounted() {\r\n                    document.querySelector(\"#logs-loader\").style.display = \"none\";\r\n                    document.querySelector(\"#logs\").style.display = \"block\";\r\n                },\r\n                computed: {\r\n                    dateRangeText () {\r\n                        let dates_array = this.dates.map(date => new Date(date));\r\n                        dates_array.sort(this.sortDates);\r\n                        this.datesLabels = dates_array.map(date => this.formatDate(date));\r\n                        return this.datesLabels.join(' â†’ ');\r\n                    },\r\n                },\r\n                methods: {\r\n                    getHelpContent() {\r\n                        let contents = [];\r\n                        contents.push({\r\n                            title: this.strings.sectionHelpTitle,\r\n                            description: this.strings.sectionHelpDescription,\r\n                        });\r\n                        return contents;\r\n                    },\r\n\r\n                    getFile(type) {\r\n                        if (!this.datesLabels.length){\r\n                            Alertify.error(\"Por favor, selecciona un rango de fechas\");\r\n                            return;\r\n                        }\r\n\r\n                        if (type === 'moodle') {\r\n                            this.loadingBtnMoodleLogs = true;\r\n                        } else if (type === 'fliplearning') {\r\n                            this.loadingBtnFliplearningLogs = true;\r\n                        } else {\r\n                            return;\r\n                        }\r\n\r\n                        let startdate = this.datesLabels[0].split('/').reverse().join('-');\r\n                        let enddate = this.datesLabels[1]\r\n                            ? this.datesLabels[1].split('/').reverse().join('-')\r\n                            : startdate;\r\n\r\n                        console.log({startdate, enddate});\r\n\r\n                        let data = {\r\n                            action: \"downloadlogs\",\r\n                            logstype: type,\r\n                            userid: this.userId,\r\n                            courseid: this.courseId,\r\n                            startdate,\r\n                            enddate,\r\n                        }\r\n                        Axios({\r\n                            method: 'post',\r\n                            url: M.cfg.wwwroot + \"/local/fliplearning/ajax.php\",\r\n                            timeout : timeout,\r\n                            params: data\r\n                        }).then((response) => {\r\n                            console.log(response);\r\n                            if (response.status == 200 && response.data.ok) {\r\n                                console.log(response.data);\r\n                                let filename = response.data.message;\r\n                                let url = `${M.cfg.wwwroot}/local/fliplearning/downloads/${filename}`;\r\n                                console.log({url});\r\n                                let link = document.createElement('a');\r\n                                link.href = url;\r\n                                link.click();\r\n                                Alertify.success(this.strings.successDownload);\r\n                            } else if (response.data.message) {\r\n                                Alertify.error(response.data.message);\r\n                            } else {\r\n                                Alertify.error(this.strings.apiErrorNetwork);\r\n                            }\r\n                        }).catch((e) => {\r\n                            Alertify.error(this.strings.apiErrorNetwork);\r\n                        }).finally(() => {\r\n                            (type === 'moodle')\r\n                                ? this.loadingBtnMoodleLogs = false\r\n                                : this.loadingBtnFliplearningLogs = false;\r\n                        });\r\n                    },\r\n\r\n                    sortDates (a, b) {\r\n                        return b.getTime() > a.getTime() ? -1 : b.getTime() < a.getTime() ? 1 : 0;\r\n                    },\r\n\r\n                    formatDate (date) {\r\n                        const year = date.getUTCFullYear();\r\n                        const month_number = date.getUTCMonth() + 1;\r\n                        const month = month_number < 10 ? `0${month_number}` : month_number;\r\n                        const day_number = date.getUTCDate();\r\n                        const day = day_number < 10 ? `0${day_number}` : day_number;\r\n                        return `${day}/${month}/${year}`;\r\n                    },\r\n\r\n                    getTimezone() {\r\n                        let information = `${this.strings.changeTimezone} ${this.timezone}`\r\n                        return information;\r\n                    },\r\n                }\r\n            });\r\n        }\r\n\r\n        return {\r\n            init: init\r\n        };\r\n    });"],"file":"logs.min.js"}